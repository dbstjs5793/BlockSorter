# BlockSorter 프로젝트

## 프로젝트 개요
BlockSorter 프로젝트는 컨베이어벨트를 통해 들어오는 나무 블록을 자동으로 분류하고 적재하는 시스템입니다.  
블록은 총 4가지 색상으로 구성되어 있으며, 그 중 3가지 색상 블록만 적재 대상으로 하고, 불량 블록은 검출하여 폐기합니다.  

센서를 통해 블록을 감지하고 컨베이어를 정지시킨 뒤, 카메라로 블록을 촬영하여 불량 여부와 색상을 판단합니다.  
이후, 각 블록의 색상에 맞는 위치에 정해진 층 구조로 블록을 적재합니다.  

---

## 프로젝트 목표
1. 컨베이어벨트에서 블록 감지 및 정지
2. YOLOv8 모델을 이용한 양불(불량/정상) 검출
3. OpenCV를 활용한 블록 색상 및 중심점 검출
4. 블록 중심 좌표를 로봇 암 좌표로 변환하여 적재
5. 불량 블록은 지정 위치로 이동하여 폐기
6. 3단 블록 적재 (1층: 스티커 원형 위치, 2~3층: 블록 사각형 중심점)

---

## 구현 방법

### 1. 알고리즘 기반 접근 (Python + OpenCV + YOLOv8 + pymycobot)
- YOLOv8 모델로 블록 정상/불량 분류
- OpenCV를 통해 블록의 색상 및 중심점 검출
- 수집된 카메라 좌표(`cx, cy`)를 선형 회귀를 이용해 로봇 암 좌표(`x, y, z, rx, ry, rz`)로 변환
- 블록 적재 위치:
  - 1층: 동그란 스티커 원형 위치 검출
  - 2층 이상: 사각형 블록 중심점 검출
- 장점:
  - 직관적 이해와 제어 가능
  - 사용자 요구에 맞춘 높은 커스터마이징 가능
- 제한:
  - 로봇 관절 각도 자동계산 및 충돌 회피 기능 제한

### 2. MoveIt 기반 접근
- ROS MoveIt으로 로봇 관절값 및 경로 계획 구현
- 장애물 구현 및 경로 최적화 가능
- 제한:
  - 컴퓨터 성능과 RViz 리소스 요구
  - 과도한 오버헤드 발생 가능

> 본 프로젝트에서는 1번 알고리즘 기반 접근 방법을 채택

---

## 사용 기술
- **Python**: 주요 제어 로직
- **OpenCV**: 블록 색상 및 중심점 검출, 원형/사각형 위치 검출
- **YOLOv8**: 블록 불량 검출
- **pymycobot**: MyCobot 로봇 암 제어
- **NumPy**: 좌표 계산 및 데이터 처리
- **선형 회귀**: 카메라 좌표 → 로봇 암 좌표 변환

---
## 코드 구조
BlockSorter/

  |
  
  ├─ RobotArm_camera_calibration # 카메라 캘리브레이션 데이터 (camera_matrix.npy, dist_coeffs.npy)

  ├─ YOLOv8/best.pt # YOLOv8 학습 모델

  ├─ Project2_code.py # 프로젝트 메인 코드

  └─ RobotArm_coordination # 카메라 좌표 → 로봇 암 좌표 변환 코드

---

## 실행 방법
1. MyCobot 연결 (`COM3`, `115200` 설정)
2. YOLOv8 모델 학습 후 `best.pt` 위치 확인
3. `Project2_code.py` 실행
4. 컨베이어에서 블록이 들어오면 자동으로 색상별 적재 및 불량품 폐기 진행
5. `q` 키를 눌러 종료

---

## 프로젝트 특징
- 실시간 블록 색상 검출 및 적재
- 불량품 자동 폐기
- 1층 원형 위치, 2~3층 블록 중심 좌표 기반 적재
- 직관적 제어 및 높은 커스터마이징 가능

---
## 시연 영상
https://youtu.be/UQKhv60RsAk

## 참고
- 카메라 좌표 → 로봇 좌표 변환 공식은 실제 수집한 데이터(`cx, cy`, `x, y, z, rx, ry, rz`) 기반 선형 회귀 모델로 생성
- 블록 색상 범위는 HSV 값 기준으로 정의되어 있음
